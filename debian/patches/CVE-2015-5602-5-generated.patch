Description: CVE-2015-5602: sudoedit path restriction bypass using symlinks
 Files regenerated for changes in CVE-2015-5602-5.patch
Bug: https://bugzilla.sudo.ws/show_bug.cgi?id=707
Bug-Debian: https://bugs.debian.org/804149
Author: Ben Hutchings <ben@decadent.org.uk>
Forwarded: not-needed

--- a/config.h.in
+++ b/config.h.in
@@ -421,6 +421,9 @@
 /* Define to 1 if you have the `nss_search' function. */
 #undef HAVE_NSS_SEARCH
 
+/* Define to 1 if you have the `openat' function. */
+#undef HAVE_OPENAT
+
 /* Define to 1 if you have the `openpty' function. */
 #undef HAVE_OPENPTY
 
--- a/configure
+++ b/configure
@@ -17073,7 +17073,7 @@ fi
 LIBS=$ac_save_LIBS
 
 for ac_func in glob nl_langinfo regcomp setenv strftime strrchr strtoll \
-	       sysconf tzset
+	       sysconf tzset openat
 do :
   as_ac_var=`$as_echo "ac_cv_func_$ac_func" | $as_tr_sh`
 ac_fn_c_check_func "$LINENO" "$ac_func" "$as_ac_var"
--- a/plugins/sudoers/def_data.c
+++ b/plugins/sudoers/def_data.c
@@ -383,6 +383,10 @@ struct sudo_defs_types sudo_defs_table[]
 	N_("Enable sudoers netgroup support"),
 	NULL,
     }, {
+	"sudoedit_checkdir", T_FLAG,
+	N_("Check the parent directory for writability when editing files with sudoedit"),
+	NULL,
+    }, {
 	"sudoedit_follow", T_FLAG,
 	N_("Follow symbolic links when editing files with sudoedit"),
 	NULL,
--- a/plugins/sudoers/def_data.h
+++ b/plugins/sudoers/def_data.h
@@ -178,8 +178,10 @@
 #define I_MAXSEQ                88
 #define def_use_netgroups       (sudo_defs_table[89].sd_un.flag)
 #define I_USE_NETGROUPS         89
-#define def_sudoedit_follow     (sudo_defs_table[90].sd_un.flag)
-#define I_SUDOEDIT_FOLLOW       90
+#define def_sudoedit_checkdir   (sudo_defs_table[90].sd_un.flag)
+#define I_SUDOEDIT_CHECKDIR     90
+#define def_sudoedit_follow     (sudo_defs_table[91].sd_un.flag)
+#define I_SUDOEDIT_FOLLOW       91
 
 enum def_tuple {
 	never,
